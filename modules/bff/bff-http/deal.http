### Variables
# Le token doit être défini après un login réussi
@access_token = {{access_token}}

### 1. Créer un deal (POST)
POST {{base_url}}/api/deals
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
  "titre": "Mon super deal4",
  "description": "Deal incroyable à ne pas manquer !",
  "prixDeal": 1200.00,
  "prixPart": 12.00,
  "nbParticipants": 100,
  "dateDebut": "2026-02-09T10:00:00",
  "dateFin": "2026-12-31T23:59:59",
  "dateExpiration": "2026-12-31T23:59:59",
  "categorieUuid": "9b358044-7928-47c0-a79f-9e966517fc41",
  "createurUuid": "545128a4-0b6c-4694-abdd-6952549381b5",
  "statut": "BROUILLON",
  "ville": "Alberta",
  "pays": "Canada",
  "listeImages": [
    {
      "urlImage": "deal_image_1.jpg",
      "isPrincipal": true,
      "presignUrl": null,
      "statut": null
    },
    {
      "urlImage": "deal_image_2.jpg",
      "isPrincipal": false,
      "presignUrl": null,
      "statut": null
    }
  ],
  "listePointsForts": [
    "Point fort 1",
    "Point fort 2",
    "Point fort 3"
  ]
}

### 2. Récupérer tous les deals (GET)
GET {{base_url}}/api/deals
Content-Type: application/json
Authorization: Bearer {{access_token}}

### 3. Récupérer un deal par UUID (GET)
GET {{base_url}}/api/deals/123e4567-e89b-12d3-a456-426614174000
Content-Type: application/json
Authorization: Bearer {{access_token}}

### 4. Mettre à jour un deal (PUT) - Sans images
# Si listeImages n'est pas présente, les images du deal ne sont pas modifiées

PUT {{base_url}}/api/deals/200caba0-7b65-4e01-9a9e-7fcc099e7a7d
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
  "titre": "Deal mis à jour4",
  "description": "Description modifiée",
  "prixDeal": 1500.00,
  "prixPart": 15.00,
  "nbParticipants": 100,
  "dateDebut": "2026-02-09T10:00:00",
  "dateFin": "2026-12-31T23:59:59",
  "dateExpiration": "2026-12-31T23:59:59",
  "categorieUuid": "9b358044-7928-47c0-a79f-9e966517fc41",
  "createurUuid": "545128a4-0b6c-4694-abdd-6952549381b5",
  "ville": "Alberta",
  "pays": "Canada",
  "listePointsForts": [
    "Nouveau point fort1",
    "Nouveau point fort2"
  ]
}

### 4.0. Mettre à jour un deal AVEC images (PUT) - Gestion intelligente
# Si listeImages est présente : gestion intelligente (ajout/modification/suppression)
# - imageUuid: null → Ajouter nouvelle image
# - imageUuid: existant → Conserver/modifier isPrincipal
# - imageUuid: absent du DTO → Supprimer de la BD
# Réponse : deal avec UNIQUEMENT les nouvelles images (avec presignUrl)

PUT {{base_url}}/api/deals/200caba0-7b65-4e01-9a9e-7fcc099e7a7d
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
  "titre": "Deal mis à jour avec images 4",
  "description": "Description modifiée 4",
  "prixDeal": 1500.00,
  "prixPart": 16.00,
  "nbParticipants": 100,
  "dateDebut": "2026-02-09T10:00:00",
  "dateFin": "2026-12-31T23:59:59",
  "dateExpiration": "2026-12-31T23:59:59",
  "categorieUuid": "9b358044-7928-47c0-a79f-9e966517fc41",
  "createurUuid": "545128a4-0b6c-4694-abdd-6952549381b5",
  "ville": "Montreal",
  "pays": "Canada",
  "listePointsForts": [
    "Nouveau point fort 1",
    "Nouveau point fort 2"
  ],
  "listeImages": [
    {
      "imageUuid": null,
      "urlImage": "image_existante.jpg",
      "isPrincipal": true,
      "statut": null
    },
    {
      "imageUuid": "8839d045-02b7-4fa6-9a0b-d26d45d7770f",
      "urlImage": "deal_image_2_1772285497134.jpg",
      "isPrincipal": false,
      "presignUrl": null,
      "statut": "PENDING"
    }
  ]
}

### 4.1. Mettre à jour uniquement le statut d'un deal (PATCH)
PATCH {{base_url}}/api/deals/200caba0-7b65-4e01-9a9e-7fcc099e7a7d/statut
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
  "statut": "BROUILLON"
}

### 4.2. Mettre à jour uniquement les images d'un deal (PATCH)
# Les anciennes images seront supprimées et remplacées par les nouvelles
PATCH {{base_url}}/api/deals/123e4567-e89b-12d3-a456-426614174000/images
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
  "listeImages": [
    {
      "imageUuid": null,
      "urlImage": "nouvelle_image_1.jpg",
      "isPrincipal": true,
      "presignUrl": null,
      "statut": null
    },
    {
      "imageUuid": null,
      "urlImage": "nouvelle_image_2.jpg",
      "isPrincipal": false,
      "presignUrl": null,
      "statut": null
    }
  ]
}

### 5. Supprimer un deal (DELETE)
DELETE {{base_url}}/api/deals/c21bbf74-4fd9-4cd4-86bb-bf2b1d661bd8
Content-Type: application/json
Authorization: Bearer {{access_token}}

### 6. Récupérer deals par statut (GET)
GET {{base_url}}/api/deals/statut/PUBLIE
Content-Type: application/json

### 7. Récupérer deals par créateur (GET)
GET {{base_url}}/api/deals/createur/123e4567-e89b-12d3-a456-426614174001
Content-Type: application/json
Authorization: Bearer {{access_token}}

### 8. Récupérer deals par catégorie (GET)
GET {{base_url}}/api/deals/categorie/123e4567-e89b-12d3-a456-426614174000
Content-Type: application/json
Authorization: Bearer {{access_token}}

### 9. Confirmer l'upload d'une image (PATCH)
### Endpoint appelé par le frontend après upload réussi vers MinIO
PATCH {{base_url}}/api/deals/123e4567-e89b-12d3-a456-426614174000/images/456e7890-e89b-12d3-a456-426614174001/confirm
Content-Type: application/json
Authorization: Bearer {{access_token}}

### 10. Confirmer l'upload de plusieurs images (PATCH)
### Endpoint appelé par le frontend après upload réussi vers MinIO
PATCH {{base_url}}/api/deals/123e4567-e89b-12d3-a456-426614174000/images/456e7890-e89b-12d3-a456-426614174001/confirm
Content-Type: application/json
Authorization: Bearer {{access_token}}
{
  "imageIds": [
    "456e7890-e89b-12d3-a456-426614174001",
    "456e7890-e89b-12d3-a456-426614174002"
  ]
}

### 11. Obtenir l'URL de lecture d'une image (GET)
### Génère une URL présignée pour lire l'image depuis MinIO
GET {{base_url}}/api/deals/123e4567-e89b-12d3-a456-426614174000/images/456e7890-e89b-12d3-a456-426614174001/url
Content-Type: application/json
Authorization: Bearer {{access_token}}

### 12. Récupérer les villes (GET)
### Génère une URL présignée pour lire l'image depuis MinIO
GET {{base_url}}/api/deals/villes
Content-Type: application/json

