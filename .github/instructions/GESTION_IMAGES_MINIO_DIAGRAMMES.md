# ğŸ”„ Diagrammes - Gestion des Images MinIO

Diagrammes de sÃ©quence dÃ©taillÃ©s pour comprendre les flux d'upload et de lecture d'images avec MinIO.

---

## ğŸ“¤ Flux d'upload complet (CrÃ©ation d'entitÃ© avec images)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontendâ”‚          â”‚   API   â”‚          â”‚  Core   â”‚          â”‚ Provider â”‚          â”‚ MinIO â”‚
â”‚ (React) â”‚          â”‚Resource â”‚          â”‚ Service â”‚          â”‚ Adapter  â”‚          â”‚       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”¬â”€â”€â”€â”˜
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚ 1. SÃ©lection imagesâ”‚                     â”‚                     â”‚                    â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚ 2. POST /api/deals â”‚                     â”‚                     â”‚                    â”‚
     â”‚ Body: {            â”‚                     â”‚                     â”‚                    â”‚
     â”‚   titre: "...",    â”‚                     â”‚                     â”‚                    â”‚
     â”‚   listeImages: [{  â”‚                     â”‚                     â”‚                    â”‚
     â”‚     urlImage: "image.jpg",                â”‚                     â”‚                    â”‚
     â”‚     nomUnique: "unique_00011.png",        â”‚                     â”‚                    â”‚
     â”‚     isPrincipal: true                     â”‚                     â”‚                    â”‚
     â”‚   }]               â”‚                     â”‚                     â”‚                    â”‚
     â”‚ }                  â”‚                     â”‚                     â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚ 3. creer(dealDTO)   â”‚                     â”‚                    â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚ 4. sauvegarder()    â”‚                    â”‚
     â”‚                    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚ 5. GÃ©nÃ©ration nom  â”‚
     â”‚                    â”‚                     â”‚                     â”‚ unique avec timestamp
     â”‚                    â”‚                     â”‚                     â”‚ "deals/unique_00011_
     â”‚                    â”‚                     â”‚                     â”‚  1707988800000.png"â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚ 6. Save to DB      â”‚
     â”‚                    â”‚                     â”‚                     â”‚ (statut: PENDING)  â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚ 7. setPresignUrl() â”‚
     â”‚                    â”‚                     â”‚                     â”‚ GÃ©nÃ¨re URL prÃ©signÃ©e
     â”‚                    â”‚                     â”‚                     â”‚ pour upload (PUT)  â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚ 8. dealModele       â”‚                    â”‚
     â”‚                    â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
     â”‚                    â”‚                     â”‚ avec presignUrl     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚ 9. dealResponseDto  â”‚                     â”‚                    â”‚
     â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚ 10. Response 201   â”‚                     â”‚                     â”‚                    â”‚
     â”‚ Body: {            â”‚                     â”‚                     â”‚                    â”‚
     â”‚   uuid: "...",     â”‚                     â”‚                     â”‚                    â”‚
     â”‚   listeImages: [{  â”‚                     â”‚                     â”‚                    â”‚
     â”‚     uuid: "...",   â”‚                     â”‚                     â”‚                    â”‚
     â”‚     nomUnique:     â”‚                     â”‚                     â”‚                    â”‚
     â”‚       "deals/unique_00011_1707988800000.png",                  â”‚                    â”‚
     â”‚     presignUrl:    â”‚                     â”‚                     â”‚                    â”‚
     â”‚       "http://minio:9000/...",            â”‚                     â”‚                    â”‚
     â”‚     statut: "PENDING"                     â”‚                     â”‚                    â”‚
     â”‚   }]               â”‚                     â”‚                     â”‚                    â”‚
     â”‚ }                  â”‚                     â”‚                     â”‚                    â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚ 11. Upload vers MinIO (PUT)               â”‚                     â”‚                    â”‚
     â”‚ xhr.open("PUT", presignUrl)               â”‚                     â”‚                    â”‚
     â”‚ xhr.send(file)     â”‚                     â”‚                     â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚ 12. Fichier stockÃ© â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ Response 200 OK    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚ 13. PATCH /api/deals/{uuid}/images/{imageUuid}/confirm         â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚ 14. mettreAJourStatutImage()               â”‚                    â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚ 15. mettreAJourStatutImage()             â”‚
     â”‚                    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚ 16. Update DB      â”‚
     â”‚                    â”‚                     â”‚                     â”‚ statut: UPLOADED   â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚ 17. Success         â”‚                    â”‚
     â”‚                    â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚ 18. Success         â”‚                     â”‚                    â”‚
     â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚ 19. Response 200   â”‚                     â”‚                     â”‚                    â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
```

---

## ğŸ“– Flux de lecture (Affichage d'image)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontendâ”‚          â”‚   API   â”‚          â”‚  Core   â”‚          â”‚ Provider â”‚          â”‚ MinIO â”‚
â”‚ (React) â”‚          â”‚Resource â”‚          â”‚ Service â”‚          â”‚ Adapter  â”‚          â”‚       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”¬â”€â”€â”€â”˜
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚ 1. GET /api/deals/{uuid}                 â”‚                     â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚ 2. lireParUuid()    â”‚                     â”‚                    â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚ 3. trouverParUuid() â”‚                    â”‚
     â”‚                    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚ 4. Load from DB    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚ 5. dealModele       â”‚                    â”‚
     â”‚                    â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚ 6. setPresignUrl()  â”‚                    â”‚
     â”‚                    â”‚                     â”‚ (pour images PENDING)                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚ 7. dealDto          â”‚                     â”‚                    â”‚
     â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚ 8. Response 200    â”‚                     â”‚                     â”‚                    â”‚
     â”‚ Body: {            â”‚                     â”‚                     â”‚                    â”‚
     â”‚   uuid: "...",     â”‚                     â”‚                     â”‚                    â”‚
     â”‚   listeImages: [{  â”‚                     â”‚                     â”‚                    â”‚
     â”‚     uuid: "...",   â”‚                     â”‚                     â”‚                    â”‚
     â”‚     nomUnique:     â”‚                     â”‚                     â”‚                    â”‚
     â”‚       "deals/unique_00011_1707988800000.png",                  â”‚                    â”‚
     â”‚     presignUrl:    â”‚                     â”‚                     â”‚                    â”‚
     â”‚       "http://minio:9000/...",            â”‚                     â”‚                    â”‚
     â”‚     statut: "UPLOADED"                    â”‚                     â”‚                    â”‚
     â”‚   }]               â”‚                     â”‚                     â”‚                    â”‚
     â”‚ }                  â”‚                     â”‚                     â”‚                    â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚ 9. Affichage image via presignUrl         â”‚                     â”‚                    â”‚
     â”‚ <img src={presignUrl} />                  â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚ 10. GET presignUrl â”‚                     â”‚                     â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚ 11. Retour fichier â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ Image binaire      â”‚                     â”‚                     â”‚                    â”‚
     â”‚                    â”‚                     â”‚                     â”‚                    â”‚
```

---

## ğŸ”„ Flux de mise Ã  jour (Modification d'image)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontendâ”‚          â”‚   API   â”‚          â”‚  Core   â”‚          â”‚ Provider â”‚
â”‚ (React) â”‚          â”‚Resource â”‚          â”‚ Service â”‚          â”‚ Adapter  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                    â”‚                     â”‚                     â”‚
     â”‚ 1. PUT /api/deals/{uuid}                 â”‚                     â”‚
     â”‚ Body: {            â”‚                     â”‚                     â”‚
     â”‚   listeImages: [{  â”‚                     â”‚                     â”‚
     â”‚     uuid: "...",   â”‚                     â”‚                     â”‚
     â”‚     urlImage: "new_image.jpg" (modifiÃ©)  â”‚                     â”‚
     â”‚   }]               â”‚                     â”‚                     â”‚
     â”‚ }                  â”‚                     â”‚                     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚                     â”‚
     â”‚                    â”‚                     â”‚                     â”‚
     â”‚                    â”‚ 2. mettreAJour()    â”‚                     â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
     â”‚                    â”‚                     â”‚                     â”‚
     â”‚                    â”‚                     â”‚ 3. mettreAJour()    â”‚
     â”‚                    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                    â”‚                     â”‚                     â”‚
     â”‚                    â”‚                     â”‚                     â”‚ 4. DÃ©tection changement
     â”‚                    â”‚                     â”‚                     â”‚ dans mettreAJourImages
     â”‚                    â”‚                     â”‚                     â”‚ SiBesoin()
     â”‚                    â”‚                     â”‚                     â”‚
     â”‚                    â”‚                     â”‚                     â”‚ 5. GÃ©nÃ©ration nouveau
     â”‚                    â”‚                     â”‚                     â”‚ nom avec timestamp
     â”‚                    â”‚                     â”‚                     â”‚ "deals/new_image_
     â”‚                    â”‚                     â”‚                     â”‚  1707999999999.jpg"
     â”‚                    â”‚                     â”‚                     â”‚
     â”‚                    â”‚                     â”‚                     â”‚ 6. Statut â†’ PENDING
     â”‚                    â”‚                     â”‚                     â”‚
     â”‚                    â”‚                     â”‚                     â”‚ 7. Save to DB
     â”‚                    â”‚                     â”‚                     â”‚
     â”‚                    â”‚                     â”‚ 8. dealModele       â”‚
     â”‚                    â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                    â”‚                     â”‚ avec nouveau        â”‚
     â”‚                    â”‚                     â”‚ presignUrl          â”‚
     â”‚                    â”‚                     â”‚                     â”‚
     â”‚                    â”‚ 9. dealDto          â”‚                     â”‚
     â”‚                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
     â”‚                    â”‚                     â”‚                     â”‚
     â”‚ 10. Response 200   â”‚                     â”‚                     â”‚
     â”‚ avec nouveau       â”‚                     â”‚                     â”‚
     â”‚ presignUrl         â”‚                     â”‚                     â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚                     â”‚
     â”‚                    â”‚                     â”‚                     â”‚
     â”‚ 11. Upload nouvelle image (mÃªme flux que crÃ©ation)             â”‚
     â”‚                    â”‚                     â”‚                     â”‚
```

---

## ğŸ¯ Points d'attention dans les diagrammes

### Ã‰tape 5 (CrÃ©ation) : GÃ©nÃ©ration du nom unique
```java
// Backend (ProviderAdapter.sauvegarder())
String nomUnique = Tools.DIRECTORY_DEALS_IMAGES
    + FilenameUtils.getBaseName(imageDealModele.getUrlImage())
    + "_" + System.currentTimeMillis()
    + "." + FilenameUtils.getExtension(imageDealModele.getUrlImage());

// RÃ©sultat : "deals/unique_00011_1707988800000.png"
```

### Ã‰tape 7 (CrÃ©ation) : GÃ©nÃ©ration URL prÃ©signÃ©e
```java
// Backend (ProviderAdapter.setPresignUrl())
String presignUrl = fileManager.generatePresignedUrl(
    Tools.DIRECTORY_DEALS_IMAGES,  // "deals/"
    img.getUrlImage()              // "deals/unique_00011_1707988800000.png"
);

// RÃ©sultat : "http://minio:9000/paytogether-images/deals/unique_00011_1707988800000.png?..."
```

### Ã‰tape 11 (CrÃ©ation) : Upload direct vers MinIO
```typescript
// Frontend (imageService.uploadToMinio())
const xhr = new XMLHttpRequest();
xhr.open("PUT", presignUrl);  // âš ï¸ MÃ©thode PUT, pas POST
xhr.setRequestHeader("Content-Type", file.type);
xhr.send(file);  // Upload binaire direct
```

### Ã‰tape 13 (CrÃ©ation) : Confirmation upload
```typescript
// Frontend (imageService.confirmUpload())
await fetch(
  `/api/deals/${dealUuid}/images/${imageUuid}/confirm`,
  { method: "PATCH" }  // âš ï¸ MÃ©thode PATCH
);
```

---

## ğŸ“Š Transition des statuts

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CRÃ‰ATION                              â”‚
â”‚                                                              â”‚
â”‚  1. Backend crÃ©e entitÃ©                                     â”‚
â”‚     â””â”€â–º Statut = PENDING                                    â”‚
â”‚                                                              â”‚
â”‚  2. Backend gÃ©nÃ¨re presignUrl                               â”‚
â”‚     â””â”€â–º Retourne au frontend                                â”‚
â”‚                                                              â”‚
â”‚  3. Frontend upload vers MinIO                              â”‚
â”‚     â””â”€â–º Success : appelle /confirm                          â”‚
â”‚     â””â”€â–º Failure : aucun appel                               â”‚
â”‚                                                              â”‚
â”‚  4. Backend met Ã  jour statut                               â”‚
â”‚     â””â”€â–º PENDING â†’ UPLOADED                                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MODIFICATION                            â”‚
â”‚                                                              â”‚
â”‚  1. Backend dÃ©tecte changement URL                          â”‚
â”‚     â””â”€â–º mettreAJourImagesSiBesoin()                         â”‚
â”‚                                                              â”‚
â”‚  2. Backend gÃ©nÃ¨re nouveau nom + timestamp                  â”‚
â”‚     â””â”€â–º Statut = PENDING                                    â”‚
â”‚                                                              â”‚
â”‚  3. MÃªme flux que crÃ©ation                                  â”‚
â”‚     â””â”€â–º Upload + Confirmation                               â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LECTURE                              â”‚
â”‚                                                              â”‚
â”‚  1. Backend vÃ©rifie statut image                            â”‚
â”‚     â””â”€â–º Si PENDING : gÃ©nÃ¨re presignUrl (GET)                â”‚
â”‚     â””â”€â–º Si UPLOADED : gÃ©nÃ¨re presignUrl (GET)               â”‚
â”‚                                                              â”‚
â”‚  2. Frontend utilise presignUrl pour affichage              â”‚
â”‚     â””â”€â–º <img src={presignUrl} />                            â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” SÃ©curitÃ© via URL prÃ©signÃ©es

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        URL PRÃ‰SIGNÃ‰E                                  â”‚
â”‚                                                                       â”‚
â”‚  http://minio:9000/paytogether-images/deals/unique_00011_...png?     â”‚
â”‚    X-Amz-Algorithm=AWS4-HMAC-SHA256                                  â”‚
â”‚    &X-Amz-Credential=minioadmin/20260215/us-east-1/s3/aws4_request   â”‚
â”‚    &X-Amz-Date=20260215T100000Z                                      â”‚
â”‚    &X-Amz-Expires=3600     â—„â”€â”€â”€ ValiditÃ© : 1 heure                  â”‚
â”‚    &X-Amz-SignedHeaders=host                                         â”‚
â”‚    &X-Amz-Signature=abc123... â—„â”€â”€â”€ Signature cryptographique        â”‚
â”‚                                                                       â”‚
â”‚  âœ… Avantages :                                                      â”‚
â”‚    - Pas de proxy par le backend                                     â”‚
â”‚    - Upload/Download direct vers MinIO                               â”‚
â”‚    - Temporaire (expire aprÃ¨s X secondes)                            â”‚
â”‚    - Signature unique par demande                                    â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š RÃ©fÃ©rences

- **Instruction complÃ¨te** : `GESTION_IMAGES_MINIO_INSTRUCTION.md`
- **Quick Reference** : `GESTION_IMAGES_MINIO_QUICK_REF.md`
- **Copilot Instructions** : `.github/copilot-instructions.md`

---

**Diagrammes v1.0** - DerniÃ¨re mise Ã  jour : 15 fÃ©vrier 2026

